PUT _ingest/pipeline/ece-json
{
  "description": "ECE Proxy version: 10001",
  "processors": [
    {
      "set": {
        "field": "timestamp_ingest",
        "value": "{{ _ingest.timestamp }}"
      }
    },
    {
      "remove": {
        "field": [
          "prospector",
          "beat",
          "host",
          "input"
        ]
      }
    },
    {
      "grok": {
        "field": "source",
        "patterns": [
          "(?<metadata.file>\\/(?<metadata.diag_name>ece_diag_.*?_\\d{2}_[A-Za-z]{3}_\\d{4}_\\d{2}_\\d{2}_\\d{2})\\/elastic\\/(?<ece.runner>.*?)\\/services\\/.*?\\/(containers\\/(elasticsearch|kibana)\\/(?<ece.cluster_id>.*?)\\/(?<ece.container>.*?)\\/)?.*$)"
        ],
        "on_failure": [
          {
            "set": {
              "field": "error",
              "value": "filepath_parse_failure"
            }
          }
        ]
      }
    },
    {
      "remove": {
        "field": "source"
      }
    },
    {
      "rename": {
        "field": "offset",
        "target_field": "metadata.offset"
      }
    }
  ]
}
